{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import _ from 'lodash';\r\nimport path from 'path';\r\nimport Promise from 'bluebird';\r\nimport toLooksLikeDirectory from './toLooksLikeDirectory';\r\nimport writeFileToAssets from './writeFileToAssets';\r\nimport writeDirectoryToAssets from './writeDirectoryToAssets';\r\nimport shouldIgnore from './shouldIgnore';\r\n\r\n/* eslint-disable import/no-commonjs */\r\nconst globAsync = Promise.promisify(require('glob'));\r\nconst fs = Promise.promisifyAll(require('fs-extra'));\r\n/* eslint-enable */\r\n\r\nconst union = (set1, set2) => {\r\n    return new Set([...set1, ...set2]);\r\n};\r\n\r\nconst getOutputDir = (compiler) => {\r\n    if (compiler.options.output.path && compiler.options.output.path !== '/') {\r\n        return compiler.options.output.path;\r\n    }\r\n\r\n    const devServer = compiler.options.devServer;\r\n\r\n    if (!devServer || !devServer.outputPath || devServer.outputPath === '/') {\r\n        throw new Error('CopyWebpackPlugin: to use webpack-dev-server, devServer.outputPath must be defined in the webpack config');\r\n    }\r\n\r\n    return devServer.outputPath;\r\n};\r\n\r\nexport default (patterns = [], options = {}) => {\r\n    if (!_.isArray(patterns)) {\r\n        throw new Error('CopyWebpackPlugin: patterns must be an array');\r\n    }\r\n\r\n    const apply = (compiler) => {\r\n        const webpackContext = compiler.options.context;\r\n        const outputPath = getOutputDir(compiler);\r\n        const fileDependencies = [];\r\n        const contextDependencies = [];\r\n        const webpackIgnore = options.ignore || [];\r\n        const copyUnmodified = options.copyUnmodified;\r\n        let writtenAssets;\r\n        let lastGlobalUpdate;\r\n\r\n        lastGlobalUpdate = 0;\r\n\r\n        compiler.plugin('emit', (compilation, cb) => {\r\n            writtenAssets = new Set();\r\n\r\n            Promise.each(patterns, (pattern) => {\r\n                let relDest;\r\n                let globOpts;\r\n\r\n                if (pattern.context && !path.isAbsolute(pattern.context)) {\r\n                    pattern.context = path.resolve(webpackContext, pattern.context);\r\n                }\r\n\r\n                const context = pattern.context || webpackContext;\r\n                const ignoreList = webpackIgnore.concat(pattern.ignore || []);\r\n\r\n                globOpts = {\r\n                    cwd: context\r\n                };\r\n\r\n                // From can be an object\r\n                if (pattern.from.glob) {\r\n                    globOpts = _.assignIn(globOpts, _.omit(pattern.from, 'glob'));\r\n                    pattern.from = pattern.from.glob;\r\n                }\r\n\r\n                const relSrc = pattern.from;\r\n                const absSrc = path.resolve(context, relSrc);\r\n\r\n                relDest = pattern.to || '';\r\n\r\n                const forceWrite = Boolean(pattern.force);\r\n\r\n                return fs\r\n                    .statAsync(absSrc)\r\n                    .catch(() => {\r\n                        return null;\r\n                    })\r\n                    .then((stat) => {\r\n                        if (stat && stat.isDirectory()) {\r\n                            contextDependencies.push(absSrc);\r\n\r\n                            // Make the relative destination actually relative\r\n                            if (path.isAbsolute(relDest)) {\r\n                                relDest = path.relative(outputPath, relDest);\r\n                            }\r\n\r\n                            return writeDirectoryToAssets({\r\n                                absDirSrc: absSrc,\r\n                                compilation,\r\n                                copyUnmodified,\r\n                                flatten: pattern.flatten,\r\n                                forceWrite,\r\n                                ignoreList,\r\n                                lastGlobalUpdate,\r\n                                relDirDest: relDest\r\n                            })\r\n                            .then((assets) => {\r\n                                writtenAssets = union(writtenAssets, assets);\r\n                            });\r\n                        }\r\n\r\n                        return globAsync(relSrc, globOpts)\r\n                            .each((relFileSrcParam) => {\r\n                                let relFileDest;\r\n                                let relFileSrc;\r\n\r\n                                relFileSrc = relFileSrcParam;\r\n\r\n                                // Skip if it matches any of our ignore list\r\n                                if (shouldIgnore(relFileSrc, ignoreList)) {\r\n                                    return false;\r\n                                }\r\n\r\n                                const absFileSrc = path.resolve(context, relFileSrc);\r\n\r\n                                relFileDest = pattern.to || '';\r\n\r\n                                // Remove any directory references if flattening\r\n                                if (pattern.flatten) {\r\n                                    relFileSrc = path.basename(relFileSrc);\r\n                                }\r\n\r\n                                const relFileDirname = path.dirname(relFileSrc);\r\n\r\n                                fileDependencies.push(absFileSrc);\r\n\r\n                                // If the pattern is a blob\r\n                                if (!stat) {\r\n                                    // If the source is absolute\r\n                                    if (path.isAbsolute(relFileSrc)) {\r\n                                        // Make the destination relative\r\n                                        relFileDest = path.join(path.relative(context, relFileDirname), path.basename(relFileSrc));\r\n\r\n                                    // If the source is relative\r\n                                    } else {\r\n                                        relFileDest = path.join(relFileDest, relFileSrc);\r\n                                    }\r\n\r\n                                // If it looks like a directory\r\n                                } else if (toLooksLikeDirectory(pattern)) {\r\n                                    // Make the path relative to the source\r\n                                    relFileDest = path.join(relFileDest, path.basename(relFileSrc));\r\n                                }\r\n\r\n                                // If there's still no relFileDest\r\n                                relFileDest = relFileDest || path.basename(relFileSrc);\r\n\r\n                                // Make sure the relative destination is actually relative\r\n                                if (path.isAbsolute(relFileDest)) {\r\n                                    relFileDest = path.relative(outputPath, relFileDest);\r\n                                }\r\n\r\n                                return writeFileToAssets({\r\n                                    absFileSrc,\r\n                                    compilation,\r\n                                    copyUnmodified,\r\n                                    forceWrite,\r\n                                    lastGlobalUpdate,\r\n                                    relFileDest\r\n                                })\r\n                                .then((asset) => {\r\n                                    writtenAssets.add(asset);\r\n                                });\r\n                            });\r\n                    });\r\n            })\r\n            .then(() => {\r\n                lastGlobalUpdate = _.now();\r\n            })\r\n            .catch((err) => {\r\n                compilation.errors.push(err);\r\n            })\r\n            .finally(cb);\r\n        });\r\n\r\n        compiler.plugin('after-emit', (compilation, callback) => {\r\n            const trackedFiles = compilation.fileDependencies;\r\n\r\n            _.forEach(fileDependencies, (file) => {\r\n                if (!_.includes(trackedFiles, file)) {\r\n                    trackedFiles.push(file);\r\n                }\r\n            });\r\n\r\n            const trackedDirs = compilation.contextDependencies;\r\n\r\n            _.forEach(contextDependencies, (context) => {\r\n                if (!_.includes(trackedDirs, context)) {\r\n                    trackedDirs.push(context);\r\n                }\r\n            });\r\n\r\n            callback();\r\n            return;\r\n        });\r\n    };\r\n\r\n    return {\r\n        apply\r\n    };\r\n};\r\n"],"sourceRoot":"/source/"}